image: acastellano/debbuilder

stages:
    - build

dev_package:
    stage: build
    script:
        - SNAPSHOTDATE=$(date +%G%m%d%k%M%S)
        - dpkg-buildpackage -uc -b
        - mkdir build
        - mv ../*.deb build/
        - PACKAGE=$(ls build)
        - curl -X POST -F file=@build/$PACKAGE http://packages.windmaker.net:8000/api/files/toggl-jira-work-logger
        - curl -X POST http://packages.windmaker.net:8000/api/repos/packages-windmaker-any-testing/file/toggl-jira-work-logger
        - "curl -X POST -H 'Content-Type: application/json' --data '{\"Name\":\"packages-windmaker-any-testing'\"$SNAPSHOT\"'\"}' http://packages.windmaker.net:8000/api/repos/packages-windmaker-any-testing/snapshots"
    artifacts:
        paths:
            - build/*
